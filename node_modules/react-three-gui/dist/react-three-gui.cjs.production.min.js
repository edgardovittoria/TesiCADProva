"use strict";function n(n){return n&&"object"==typeof n&&"default"in n?n.default:n}Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=n(e),r=require("react-three-fiber"),o=n(require("styled-components")),i=require("@react-spring/web"),a=require("react-use-gesture"),u=n(require("react-use-measure")),c=require("three"),l=require("react-color"),s=require("@react-spring/three");function f(){return(f=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n}).apply(this,arguments)}function d(n,e){return e||(e=n.slice(0)),n.raw=e,n}var p=e.createContext({values:{current:new Map},gui:{current:new Map},state:{current:new Map},controls:[],addControl:function(n){return n},removeControl:function(){}});function v(n){return function(e){var r=e.children,o=function(n,e){if(null==n)return{};var t,r,o={},i=Object.keys(n);for(r=0;r<i.length;r++)e.indexOf(t=i[r])>=0||(o[t]=n[t]);return o}(e,["children"]);return t.createElement(p.Consumer,null,(function(e){return t.createElement(n,Object.assign({},o),t.createElement(p.Provider,{value:e},r))}))}}var b,x=v(r.Canvas);(b=exports.ControlType||(exports.ControlType={})).NUMBER="number",b.STRING="string",b.BUTTON="button",b.BOOLEAN="boolean",b.SELECT="select",b.COLOR="color",b.XYPAD="xypad",b.FILE="file",b.CUSTOM="custom";var m={type:exports.ControlType.NUMBER,value:0},g=function(n,e,t){return void 0!==t?Math.min(Math.max(n,e),t):Math.min(n,e)},h=function(n,e,t,r,o){return(n-e)*(o-r)/(t-e)+r};function y(n,t){var r=e.useState((function(){try{var e=window.localStorage.getItem(n);return e?JSON.parse(e):t}catch(n){return console.log(n),t}})),o=r[0],i=r[1];return[o,function(e){try{var t=e instanceof Function?e(o):e;i(t),window.localStorage.setItem(n,JSON.stringify(t))}catch(n){console.log(n)}}]}function E(){var n=d(["\n  display: flex;\n  font-family: sans-serif;\n  white-space: nowrap;\n  font-size: 14px;\n  color: rgba(0, 0, 0, 0.75);\n  justify-content: flex-end;\n  ","\n  ","\n"]);return E=function(){return n},n}function k(){var n=d(["\n  display: flex;\n  ","\n  justify-content: flex-end;\n  padding: 0 8px;\n"]);return k=function(){return n},n}function T(){var n=d(["\n  display: flex;\n  font-family: sans-serif;\n  font-size: 14px;\n  color: rgba(0, 0, 0, 0.4);\n  width: 56px;\n  user-select: none;\n  ","\n"]);return T=function(){return n},n}function w(){var n=d(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding: 8px 0;\n"]);return w=function(){return n},n}var C=o.div(w()),O=o.label(T(),(function(n){return!0===n.flexLabel?"flex: 1;":""})),L=o.div(k(),(function(n){return!0!==n.flexLabel?"flex: 1;":""})),R=o.div(E(),(function(n){return n.stack?"flex: 1;":""}),(function(n){return n.stack?"":"width: 42px;"}));function P(n){var e=n.htmlFor,r=n.label,o=n.flexLabel,i=n.value,a=n.children;return n.stack?t.createElement("div",null,t.createElement(C,null,t.createElement(O,{flexLabel:o},r),t.createElement(R,{stack:!0,flexLabel:o},i)),a):t.createElement(C,null,t.createElement(O,{flexLabel:o,htmlFor:e},r),t.createElement(L,{flexLabel:o},a),void 0!==i&&t.createElement(R,null,i))}function _(){var n=d(["\n  -webkit-appearance: none;\n  width: 100%;\n  background: transparent;\n  display: inline-block;\n\n  &:focus {\n    outline: none;\n  }\n\n  &::-webkit-slider-runnable-track {\n    width: 100%;\n    height: 12px;\n    cursor: pointer;\n    background: rgba(0, 0, 0, 0.045);\n    border-radius: 10px;\n  }\n\n  &::-webkit-slider-thumb {\n    border: none;\n    height: 20px;\n    width: 20px;\n    border-radius: 50%;\n    background: #ffffff;\n    cursor: pointer;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.22);\n    -webkit-appearance: none;\n    margin-top: -4px;\n  }\n\n  &:focus::-webkit-slider-runnable-track {\n    outline: none;\n  }\n"]);return _=function(){return n},n}var S=o.input(_());function F(){var n=d(["\n  opacity: 0;\n  margin-right: -15px;\n  & + ",':after {\n    position: absolute;\n    content: "";\n    display: inline-block;\n    height: 4px;\n    width: 8px;\n    border-left: 2px solid;\n    border-bottom: 2px solid;\n    left: 3px;\n    top: 4px;\n    opacity: 0;\n    transform: translate(0px, 2px) rotate(-45deg);\n    transition: ease-in-out 125ms;\n    transition-property: opacity, transform;\n  }\n  &:checked + ',":after {\n    opacity: 1;\n    transform: translate(0px, 0px) rotate(-45deg);\n  }\n  &:checked + "," {\n    background: rgba(0, 0, 0, 0.045);\n    border-color: rgba(0, 0, 0, 0.085);\n  }\n"]);return F=function(){return n},n}function M(){var n=d(["\n  height: 16px;\n  width: 16px;\n  border: 2px solid rgba(0, 0, 0, 0.065);\n  border-radius: 4px;\n  position: relative;\n  margin-top: -1px;\n  transition: ease-in-out 125ms;\n  transition-property: background-color, border-color;\n"]);return M=function(){return n},n}var I=o.label(M()),B=o.input(F(),I,I,I);function U(){var n=d(["\n  display: block;\n\n  font-family: sans-serif;\n  font-size: 14px;\n  color: rgba(0, 0, 0, 0.4);\n\n  display: block;\n  position: relative;\n\n  width: 100%;\n  height: 32px;\n\n  color: #000;\n\n  border: 0;\n  background-color: rgba(0, 0, 0, 0.045);\n  border-radius: 4px;\n  padding: 0 4px;\n"]);return U=function(){return n},n}var G=o.button(U());function A(){var n=d(["\n  position: absolute;\n  top: 24px;\n  right: 0px;\n  z-index: 100;\n"]);return A=function(){return n},n}function j(){var n=d(["\n  width: 32px;\n  height: 16px;\n  border: 2px solid white;\n  box-shadow: 0 0 1px 0 rgba(0, 0, 0, 0.3);\n  cursor: pointer;\n"]);return j=function(){return n},n}function N(){var n=d(["\n  position: relative;\n\n  > div {\n    box-sizing: border-box !important;\n  }\n"]);return N=function(){return n},n}var H=o.div(N()),D=o.div(j()),V=o.div(A());function q(){var n=d(["\n  display: block;\n\n  font-family: sans-serif;\n  font-size: 14px;\n  color: rgba(0, 0, 0, 0.4);\n\n  display: block;\n  position: relative;\n\n  width: 100%;\n  height: 32px;\n\n  color: #000;\n\n  margin-left: 8px;\n\n  border: 0;\n  background-color: rgba(0, 0, 0, 0.025);\n  border-radius: 4px;\n  padding: 0 4px;\n"]);return q=function(){return n},n}var z=o.select(q());function X(){var n=d(["\n  display: block;\n\n  font-family: sans-serif;\n  font-size: 14px;\n  color: rgba(0, 0, 0, 0.4);\n\n  display: block;\n  position: relative;\n\n  width: 100%;\n  height: 32px;\n\n  color: #000;\n\n  margin-left: 8px;\n\n  border: 0;\n  background-color: rgba(0, 0, 0, 0.025);\n  border-radius: 4px;\n  padding: 0 4px;\n"]);return X=function(){return n},n}var Y=o.input(X()),J=t.memo((function(n){var e=n.setValue;return t.createElement(P,{label:n.name},t.createElement(Y,{value:n.value,onChange:function(n){return e(n.target.value)}}))}));function W(){var n=d(["\n  width: 100%;\n"]);return W=function(){return n},n}var K,Q=o.input(W()),Z=((K={})[exports.ControlType.NUMBER]=function(n){var r,o=n.name,i=n.value,a=n.setValue,u=n.options,c=e.useRef(null),l=e.useRef(null),s=u.min,f=void 0===s?u.scrub?-Infinity:0:s,d=u.max,p=void 0===d?u.scrub?Infinity:Math.PI:d,v=(null!==(r=u.distance)&&void 0!==r?r:u.scrub)?2:p-f,b=e.useState(u.scrub?150:h(i,f,p,0,300)),x=b[0],m=b[1],y=e.useCallback((function(){u.scrub&&(m(150),l.current=null)}),[u.scrub]);return e.useEffect((function(){var n=c.current;return n&&n.addEventListener("change",y),function(){n&&n.removeEventListener("change",y)}}),[y,c]),t.createElement(P,{label:o,value:(i||0).toFixed(2)},t.createElement(S,{ref:c,type:"range",value:x,min:0,max:300,onChange:function(n){var e=Number(n.target.value);m(e),null===l.current&&(l.current=i);var t=(u.scrub?l.current:0)+h(e-(u.scrub?150:0),0,300,u.scrub?0:f,u.scrub?2*v:p);a(g(t,f,p))}}))},K[exports.ControlType.BOOLEAN]=function(n){var e=n.setValue,r="Control"+n.id;return t.createElement(P,{flexLabel:!0,label:n.name,htmlFor:r},t.createElement(B,{id:r,type:"checkbox",checked:n.value,onChange:function(n){return e(n.currentTarget.checked)}}),t.createElement(I,{htmlFor:r}))},K[exports.ControlType.SELECT]=function(n){var e=n.setValue,r=n.options.items;return t.createElement(P,{label:n.name},t.createElement(z,{value:n.value,onChange:function(n){return e(n.currentTarget.value)}},(void 0===r?[]:r).map((function(n,e){return t.createElement("option",{key:e},n)}))))},K[exports.ControlType.COLOR]=function(n){var r=n.name,o=n.value,i=n.setValue,a=n.options,u=a.inline,c=void 0!==u&&u,s=a.picker,f=void 0===s?"chrome":s,d=e.useState(!1),p=d[0],v=d[1],b=e.useRef(),x=function(n){b.current&&!b.current.contains(n.target)&&v(!1)};e.useEffect((function(){return document.body.addEventListener("click",x),function(){document.body.removeEventListener("click",x)}}),[]);var m={color:o,onChange:function(n){return i(n.rgb)},disableAlpha:a.disableAlpha,colors:a.colors},g=l.ChromePicker;switch(f){case"alpha":g=l.AlphaPicker;break;case"block":g=l.BlockPicker;break;case"circle":g=l.CirclePicker;break;case"compact":g=l.CompactPicker;break;case"github":g=l.GithubPicker;break;case"hue":g=l.HuePicker;break;case"material":g=l.MaterialPicker;break;case"sketch":g=l.SketchPicker,m.presetColors=a.colors;break;case"slider":g=l.SliderPicker;break;case"swatches":g=l.SwatchesPicker;break;case"twitter":g=l.TwitterPicker}return t.createElement(P,{stack:c,label:r,flexLabel:!0},t.createElement(H,null,c?t.createElement(g,Object.assign({},m,{triangle:c?"hide":void 0,width:268})):t.createElement(t.Fragment,null,t.createElement(D,{style:{backgroundColor:o},onClick:function(){return v((function(n){return!n}))}}),t.createElement(V,{hidden:!0!==p,ref:b},t.createElement(g,Object.assign({},m))))))},K[exports.ControlType.STRING]=J,K[exports.ControlType.BUTTON]=function(n){var e=n.options;return t.createElement("div",{style:{paddingTop:8,paddingBottom:8}},t.createElement(G,{onClick:function(n){e.onClick&&e.onClick(n)}},n.name))},K[exports.ControlType.FILE]=function(n){var e=n.setValue,r=n.options;return t.createElement(P,{label:n.name},t.createElement(Q,{type:"file",onChange:function(n){var t,o=null!==(t=r.loader)&&void 0!==t?t:new c.FileLoader;o.setCrossOrigin&&o.setCrossOrigin("");var i=o.load(URL.createObjectURL(n.currentTarget.files&&n.currentTarget.files[0]));e(i)}}))},K[exports.ControlType.XYPAD]=function(n){var r=n.name,o=n.value,c=n.setValue,l=n.options,s=e.useRef(null),d=l.distance,p=void 0===d?1:d,v=l.scrub,b=void 0!==v&&v,x=u(),m=x[0],y=x[1],E=y.width,k=y.height,T=i.useSpring((function(){return{from:{x:o.x,y:o.y},onChange:function(n,e){var t=g(h(n,0,("x"===e.key?E:k)/2,0,p),-p,p)||0;b||c((function(n){var r;return f({},n,((r={})[e.key]=t<1e-5&&t>-1e-5?0:t,r))}))}}}),[E,k]),w=T[0],C=T[1],O=a.useDrag((function(n){var e=n.down,t=n.movement;e&&!s.current?s.current=o:e||(s.current=null),C({x:e?t[0]:0,y:e?t[1]:0}),b&&(e?c((function(){return{x:s.current.x+h(t[0],0,E/2,0,p),y:s.current.y+h(t[1],0,k/2,0,p)}})):s.current=o)})),L=w.x.to((function(n){return g(n+E/2,0,E)})),R=w.y.to((function(n){return g(n+k/2,0,k)}));return t.createElement(P,{stack:!0,label:r,value:"x: "+o.x.toFixed(1)+", y: "+o.y.toFixed(1)},t.createElement(i.animated.svg,Object.assign({ref:m,style:{userSelect:"none",borderRadius:8,border:"1px solid #f0f0f0"},width:"100%",height:200,xmlns:"http://www.w3.org/2000/svg"},O()),t.createElement("rect",{fill:"rgb(250, 250, 250)",width:"100%",height:"100%"}),t.createElement(i.animated.line,{x1:L,x2:L,y1:0,y2:"100%",stroke:"#ccc"}),t.createElement(i.animated.line,{x1:0,x2:"100%",y1:R,y2:R,stroke:"#ccc"}),t.createElement(i.animated.g,{style:{transform:i.to([L,R],(function(n,e){return"translate("+n+"px, "+e+"px)"}))}},t.createElement("circle",{r:8,fill:"#ccc"}),t.createElement("circle",{r:4,fill:"#aaa"}))))},K),$=function(n){return t.createElement(P,{label:n.name},'"',n.options.type,'" not found')},nn=function(n){var r,o,i,a=n.name,u=n.id,c=n.value,l=n.options,s=e.useContext(p),f=e.useState(s.values.current&&s.values.current.has(u)?s.values.current.get(u):c),d=f[0],v=f[1];e.useEffect((function(){s.values.current.set(u,d)}),[s.values,u,d]),e.useEffect((function(){s.gui.current.set(u,v)}),[s.gui,u]);var b=null!==(r=null!==(o=l.component)&&void 0!==o?o:Z[null!==(i=l.type)&&void 0!==i?i:exports.ControlType.NUMBER])&&void 0!==r?r:$;return t.createElement(b,{id:u,name:a,value:d,setValue:function(n){var e,t,r,o;null===(e=s.gui.current)||void 0===e||null===(t=e.get(u))||void 0===t||t(n),null===(r=s.state.current)||void 0===r||null===(o=r.get(u))||void 0===o||o(n)},options:l})};function en(){var n=d(["\n  background: ",";\n  padding: 16px;\n  display: ",";\n  margin-bottom: 8px;\n"]);return en=function(){return n},n}function tn(){var n=d(["\n  display: block;\n  font-family: sans-serif;\n  font-size: 13px;\n  font-weight: bold;\n  padding-left: 16px;\n  cursor: pointer;\n  position: relative;\n  user-select: none;\n\n  &:before,\n  &:after {\n    content: '';\n    position: absolute;\n    top: 8px;\n    right: 16px;\n    width: 12px;\n    height: 2px;\n    background-color: #333;\n    /* transition: transform 0.25s ease-out; */\n  }\n  &:before {\n    transform: rotate(","deg);\n  }\n\n  &:after {\n    transform: rotate(","deg);\n  }\n"]);return tn=function(){return n},n}var rn=o.h2(tn(),(function(n){return n.open?0:90}),(function(n){return n.open?0:180})),on=o.div(en(),(function(n){return n.bg?"#f9f9f9":"#fff"}),(function(n){return n.open?"block":"none"})),an=function(n){var r,o=n.title,i=n.controls,a=n.options,u=e.useState(null===(r=!(void 0===a?{}:a).defaultClosed)||void 0===r||r),c=u[0],l=u[1],s="DEFAULT_GROUP"!==o;return t.createElement("div",null,s&&t.createElement(rn,{open:c,onClick:function(){return l((function(n){return!n}))}},o),t.createElement(on,{open:c,bg:s},Array.from(i).map((function(n){return t.createElement(nn,Object.assign({key:n.id+"_"+n.name},n))}))))};function un(){var n=d(["\n  padding-bottom: 8px;\n  overflow-y: auto;\n  max-height: calc(100vh - 42px);\n"]);return un=function(){return n},n}function cn(){var n=d(["\n  width: 30px;\n  height: 18px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: auto;\n  cursor: pointer;\n  &:after {\n    content: '';\n    display: block;\n    height: 3px;\n    width: 16px;\n    background-color: white;\n  }\n  "," {\n    &:before {\n      content: '';\n      display: block;\n      position: absolute;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      left: 0;\n    }\n  }\n"]);return cn=function(){return n},n}function ln(){var n=d(["\n  display: flex;\n  align-items: center;\n  position: relative;\n  padding-left: 16px;\n  padding-right: 16px;\n  height: 42px;\n  font-family: sans-serif;\n  font-size: 14px;\n  color: #fff;\n  cursor: move;\n  cursor: grab;\n  user-select: none;\n  background-color: #000;\n  border-top-left-radius: 8px;\n  border-top-right-radius: 8px;\n  border-bottom-left-radius: ","px;\n  border-bottom-right-radius: ","px;\n  box-shadow: 0 0 14px 0 rgba(0, 0, 0, 0.14);\n  "," {\n    border-top-left-radius: 0px;\n    border-top-right-radius: 0px;\n    border-bottom-left-radius: 0px;\n    border-bottom-right-radius: 0px;\n  }\n"]);return ln=function(){return n},n}function sn(){var n=d(["\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: ",";\n  right: ",";\n  bottom: ",";\n  left: ",";\n  width: ","px;\n  border-radius: 16px;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.12);\n\n  "," {\n    transform: none !important;\n    flex-direction: column-reverse;\n    top: auto;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    width: auto;\n  }\n"]);return sn=function(){return n},n}var fn,dn="@media only screen and (max-width: 600px)";function pn(n){return function(e){return n.includes(e["data-anchor"])?"16px":"auto"}}!function(n){n.TOP_LEFT="top_left",n.TOP_RIGHT="top_right",n.BOTTOM_LEFT="bottom_left",n.BOTTOM_RIGHT="bottom_right"}(fn||(fn={}));var vn=o(i.animated.div)(sn(),pn([fn.TOP_LEFT,fn.TOP_RIGHT]),pn([fn.BOTTOM_RIGHT,fn.TOP_RIGHT]),pn([fn.BOTTOM_RIGHT,fn.BOTTOM_LEFT]),pn([fn.TOP_LEFT,fn.BOTTOM_LEFT]),(function(n){return n["data-width"]}),dn),bn=o(i.animated.div)(ln(),(function(n){return n["data-collapsed"]?0:8}),(function(n){return n["data-collapsed"]?0:8}),dn),xn=o.div(cn(),dn),mn=o(i.animated.div)(un()),gn=function(n){var r=n.title,o=void 0===r?"react-three-gui":r,c=n.defaultClosedGroups,l=void 0===c?[]:c,s=n.width,d=void 0===s?300:s,v=n.style,b=void 0===v?{}:v,x=n.anchor,m=void 0===x?fn.TOP_RIGHT:x,h=e.useContext(p).controls,E=y("REACT_THREE_GUI__COLLAPSED",n.collapsed),k=E[0],T=E[1],w=y("REACT_THREE_GUI__"+m,[0,0]),C=w[0],O=w[1],L=u(),R=L[0],P=L[1],_=i.useSpring((function(){return{pos:C,onRest:function(n){O(n.value)}}})),S=_[0].pos,F=_[1],M=[fn.TOP_LEFT,fn.BOTTOM_LEFT].includes(m),I=[fn.TOP_RIGHT,fn.TOP_LEFT].includes(m),B=a.useDrag((function(n){var e=n.movement,t=n.memo,r=void 0===t?S?S.getValue?S.getValue():S.get():0:t,o=e[0]+r[0],i=e[1]+r[1];return F({pos:[M?g(o,1,window.innerWidth-d-32):g(o,-window.innerWidth+d+32,1),I?g(i,1,window.innerHeight):g(i,-window.innerHeight+P.height+32,1)]}),r})),U=function(n){var e;return{defaultClosed:null!==(e=null==l?void 0:l.includes(n))&&void 0!==e&&e}},G=Array.from(h).reduce((function(n,e){var t,r=(null==e||null===(t=e.options)||void 0===t?void 0:t.group)||"DEFAULT_GROUP";return n[r]=n[r]||[],n[r].push(e),n}),{});return t.createElement(vn,{"data-width":d,"data-anchor":m,ref:R,style:f({},b,{transform:i.to([S],(function(n){return"translate3d("+n[0]+"px,"+n[1]+"px,0)"}))})},t.createElement(bn,Object.assign({"data-collapsed":k},B()),o,t.createElement(xn,{collapsed:k,onClick:function(){return T((function(n){return!n}))}})),t.createElement(mn,{hidden:!k,style:{maxHeight:I?i.to([S],(function(n){return"calc(100vh - "+(n[1]+92)+"px)"})):void 0}},Object.entries(G).map((function(n){var e=n[0];return t.createElement(an,{key:e,title:e,controls:n[1],options:U(e)})}))))};gn.Provider=function(n){var r=n.children,o=e.useState([]),i=o[0],a=o[1],u=e.useRef(new Map),c=e.useRef(new Map),l=e.useRef(new Map);return t.createElement(p.Provider,{value:{values:u,gui:c,state:l,controls:i,addControl:function(n){return n.id=String(Math.random()),a((function(e){return[].concat(e,[n])})),n},removeControl:function(n){a((function(e){return e.filter((function(e){return e.id!==n.id}))}))}}},r)},gn.Canvas=x,exports.BaseControl=P,exports.Controls=gn,exports.ControlsContext=p,exports.DEFAULT_GROUP="DEFAULT_GROUP",exports.useControl=function(n,t){void 0===t&&(t=m);var r=e.useContext(p),o=e.useState(null),i=o[0],a=o[1],u=e.useState(function(n){if(n.hasOwnProperty("value"))return n.value;switch(n.type){case exports.ControlType.NUMBER:return 0;case exports.ControlType.COLOR:return"#ff0000";case exports.ControlType.STRING:return"";case exports.ControlType.SELECT:return(n.items||[""])[0];case exports.ControlType.BOOLEAN:return!1;case exports.ControlType.FILE:return new c.FileLoader;case exports.ControlType.XYPAD:return{x:0,y:0}}}(t)),l=u[0],f=u[1],d=s.useSpring((function(){return{value:l,config:"object"==typeof t.spring?t.spring:void 0}})),v=d[0],b=d[1],x=function(n){return b({value:n})};return t.state&&(l=t.state[0],f=t.state[1]),e.useEffect((function(){r.state.current&&i&&r.state.current.set(i,t.spring?x:f)}),[r.state,i]),e.useEffect((function(){var e=r.addControl({id:t.id,name:n,value:l,options:t});return a(e.id),function(){r.removeControl(e)}}),[]),e.useEffect((function(){t.spring&&b({value:l}),t.onChange&&t.onChange(l)}),[t,b,l]),t.spring?v.value:l},exports.withControls=v;
//# sourceMappingURL=react-three-gui.cjs.production.min.js.map
